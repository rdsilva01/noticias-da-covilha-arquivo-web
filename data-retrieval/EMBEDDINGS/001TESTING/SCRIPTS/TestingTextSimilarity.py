import json
import os
from transformers import AutoTokenizer, AutoModelForCausalLM, AutoModelForSequenceClassification
import torch
import numpy as np

def square_rooted(x):
    from math import sqrt 
    return round(sqrt(sum([a*a for a in x])),3)

def Cosine(x,y):
    numerator = sum([a*b for a,b in zip(x,y)])
    denominator = square_rooted(x)*square_rooted(y)
    return round(numerator/float(denominator),3)

# GET THE EMBEDDINGS
def getTextEmbeddings(text, model, tokenizer):
    input_ids = tokenizer.encode(text, return_tensors="pt", truncation=True, max_length=100, add_special_tokens = True)
    outputs = model(input_ids, output_hidden_states=True)
    embeddings = outputs.hidden_states[-1]

    mean_embedding = torch.mean(embeddings, dim=1)
    np_mean = mean_embedding[0].tolist()
    
    # voltar a converter para numpy quando se popular
    return np_mean


##############
##############
## POLÍTICA ##
##############
##############
title_ref = "Braga no caminho do Covilhã"
text_ref = "Taça de Portugal O Sporting da Covilhã defronta, a 18 de Outubro, em casa, o líder da Liga Sagres, o Braga, na 3ª eliminatória da Taça de Portugal. Pela terceira vez consecutiva o Sertanense joga com o Porto, mas desta vez, no Estádio do Dragão. O Alcains viaja até ao terreno do União da Madeira."
title_plus_text_ref = title_ref + ". " + text_ref

# GOOD
title_1 = "Serranos perdem com o Feirense"
text_1 = "A vencer o líder Feirense por 2-0, ao intervalo, o Sporting da Covilhã não conseguiu defender a vantagem e permitiu a reviravolta no marcador. Pizzi e Edgar marcaram pelos Leões da Serra. Após o descanso Pastel reduziu, Igor Sousa igualou a partida e Roberto fixou o resultado final em 3-2. Já nos descontos os serranos atiraram uma bola ao poste e, no minuto seguinte, reclamaram penálti sobre Pizzi, que poderia dar um ponto ao Covilhã, mas o árbitro nada assinalou. (Mais informações na edição em papel da próxima semana)"
title_plus_text_1 = title_1 + ". " + text_1

# GOOD
title_2 = "Joãozinho do Setúbal está a treinar no Sporting da Covilhã"
text_2 = "Joãozinho, brasileiro de 19 anos que este ano chegou a Portugal para representar o Vitória de Setúbal, fez esta tarde o segundo treino no Sporting da Covilhã. O jogador, dispensado pelos sadinos, e que só pode ser inscrito em Janeiro, na reabertura do mercado, ainda não assinou pelos Leões da Serra. João Santos ingressou no Vitória de Setúbal proveniente da Associação Atlética Internacional de Bebedouro, do Brasil. Na Liga Sagres fez quatro jogos e entrou na segunda parte na partida entre os sadinos e o Sporting da Covilhã, em jogo da Taça da Liga, disputado em Outubro no Complexo Desportivo da Covilhã. Vasco Varão é outro nome apontado como possível reforço dos serranos. Justin Hay, canadiano que estava à experiência, já não se encontra na Covilhã. O médio Paulo Vaz e o ponta-de-lança Pedro Ribeiro continuam lesionados e não estiveram no apronto de hoje. Beré, atacante, e Ervões, central, continuam fora das contas de João Salcedas, por estarem a contas com um processo disciplinar. Os dois jogadores, alegadamente vistos numa festa, após um jogo, em noite de folga, depois do recolher obrigatório imposto pelo clube, receberam a nota de culpa e ainda esta semana devem responder. (Na foto Joãozinho no treino desta tarde, entre Milton e Sufrim)"
title_plus_text_2 = title_2 + ". " + text_2

# GOOD
title_3 = "Sp. Covilhã empata a uma bola com Oliveirense"
text_3 = "O Sporting da Covilhã empatou esta tarde a uma bola com a Oliveirense, num jogo sonolento a que faltou emoção e atrevimento por parte de ambos os emblemas. Numa tarde gélida e com o vento a soprar muito forte, as 455 pessoas que se encontravam nas bancadas do Complexo Desportivo da Covilhã assistiram a uma primeira parte sem qualquer ocasião flagrante de golo. Os tentos foram apontados no regresso dos balneários por Basílio, aos 79 minutos, que logo no início do segundo tempo tinha atirado ao poste, e João Pedro, ao minuto 86. Os serranos chegaram à vantagem após uma jogada de insistência. Steven Vitória acertou na barra, a bola ressaltou para o lado direito, onde Auri atirou ao poste. Na recarga Basílio emendou para o fundo das redes. Sete minutos depois, na marcação de um livre, que resulta de uma falta contestada pelos Leões da Serra, João Pedro rematou de longe para a igualdade. Jogada a 13ª jornada da Liga Vitalis o Sporting da Covilhã mantém o 12º lugar, com 15 pontos. (Comentário do jogo na edição em papel)"
title_plus_text_3 = title_3 + ". " + text_3

# GOOD
title_4 = "Leões empatam em Belém na despedida de Gang"
text_4 = "Covilhã empata a zero e mantém oitavo lugar na tabela Sem chama. Sem emoção. Sem bom futebol. Assim se pode resumir a partida do último domingo, no Restelo, onde o Sporting da Covilhã continuou a somar pontos ao empatar a zero com o Belenenses. Um ponto que mantém os serranos num tranquilo oitavo lugar e deixa os azuis em zona aflitiva. Naquela que terá sido a última partida disputada pelo chinês Gang, o Covilhã, no início, até foi mais dominador, embora sem criar grandes calafrios ao guardião Coelho. Com um calor anormal, o jogo demorou a ter motivos de interesse, sendo disputado essencialmente na zona intermediária e de forma lenta, o que possibilitou uma tarde relativamente descansada a ambos os guarda-redes. O primeiro lance de alguma emoção surgiu apenas aos 26 minutos, quando um remate longínquo de Aníbal Capela passou um pouco por cima da baliza azul. Depois da meia hora, o Belenenses respondeu e aos 36 minutos foi Nuno Santos quem impediu Tomané de provocar maiores estragos. Aos 45 minutos, o lance de maior perigo para a baliza covilhanense quando Ricardo Rocha, de cabeça, quase fez autogolo, com a bola ainda a embater na barra. Se a primeira parte tinha sido má, a segunda em nada foi melhor. E só mesmo nos últimos 10 minutos os da Cruz de Cristo forçaram o Covilhã a maior atenção. Aos 81 minutos, Waldir atirou para o fundo das redes visitantes, mas o árbitro assistente de Bruno Esteves já havia assinalado um fora de jogo. E aos 83 minutos, Abel Camará rematou torto em plena área serrana. Já nos descontos, Fofana cruzou para o cabeceamento de Filipe Fernandes, que o guardião Coelho desviou, ficando a bola em cima da linha de baliza para desespero dos cerca de 300 adeptos serranos presentes no Restelo. Com este empate, o Covilhã continua na zona intermédia da tabela classificativa, recebendo na próxima jornada o Moreirense. Um jogo que decorre pelas 11 e 15 da manhã, com transmissão televisiva pela SporTV."
title_plus_text_4 = title_4 + ". " + text_4

# GOOD
title_5 = "Ronaldo do Venlo no Covilhã"
text_5 = "Jorge Chula reforça serranos. O extremo Jorge Chula, futebolista formado no Porto que representava a União de Leiria, foi dispensado do clube do Lis e emprestado ao Sporting da Covilhã. Recorde-se que Jorge Chula já esteve, há dois anos, perto dos serranos, mas acabou por não ingressar no clube. É um jogador que joga preferencialmente a extremo, tem 21 anos e na terça-feira já não integrou os trabalhos da equipa de Manuel Cajuda. No Leiria, esta época foi apenas utilizado na Taça de Portugal e na Taça da Liga. Formado no Porto, teve passagem também pelo Tourizense e esteve inclusive emprestado ao Venlo, da Holanda, onde era apelidado de \"Ronaldo de Venlo\" devido à sua qualidade técnica."
title_plus_text_5 = title_5 + ". " + text_5

# BAD
title_6 = "Homem morto em casa há dois meses"
text_6 = "Na Covilhã Um homem de 84 anos foi, na segunda-feira, encontrado morto na casa onde residia sozinho, na Covilhã, onde já não era visto desde há cerca de dois meses, disse hoje à agência Lusa fonte da PSP. Barata Martins, comandante distrital da PSP de Castelo Branco, adiantou que o corpo foi encontrado sem sinais de crime. O indivíduo não mantinha relações com familiares e já não era visto há cerca de dois meses, explicou. Na segunda-feira, pouco depois das 18:30, os bombeiros e a PSP foram chamados para abrir a porta de casa, na Rua José Ramalho, \"na sequência de queixas de vizinhos\", nomeadamente por causa de cheiros provocados pela decomposição do corpo, acrescentou. Estima-se que o idoso estivesse morto em casa há cerca de dois meses, sendo que \"do corpo restava apenas a ossada\", acrescentou outra fonte no local. Segundo o comandante da PSP, o homem estava sinalizado pela polícia como um idoso que vivia sozinho, mas \"a partir do momento em que se esconde, dificulta a tarefa\" de acompanhamento. Na sequência deste caso, Barata Mendes apelou à população sénior para que \"mantenha um contacto regular com alguém, até mesmo com a polícia\", em complemento ao trabalho diário da PSP, que \"bate à porta\" de alguns casos. De acordo com João de Deus, delegado de Saúde Pública da Covilhã, este caso é pelo menos o terceiro, desde o verão, de idosos isolados encontrados mortos no concelho. Aquele responsável apelou às famílias para que \"procurem manter contacto com os mais velhos - diariamente seria o ideal -, ou encontrem uma forma de vigilância eletrónica ou informática\"."
title_plus_text_6 = title_6 + ". " + text_6

# BAD
title_7 = "O livro perdido da Covilhã"
text_7 = "Um povo que o podia ser de criadores acaba por ser uma matilha de aldrabões Eduardo Lourenço tem-nos questionado permanentemente sobre a nossa origem / condições ou inevitabilidade quiçá o nosso destino quase fatal como pessoas e País. Um destes dias fui ouvir Gabriel Magalhães que conhecia de alguns escritos e me deixou maravilhado ante a riqueza de pensamento reflectido em \"Madrugada na tua alma\". A partir desta obra realço alguns aspectos que utilizarei como termo de análise / comparação. Parafraseando sem distorcer, \"não admira que num País como o nosso, tão dado a esquecer os seus talentos, possuidores de enormes qualidades, nos deparemos amiúde com essas virtudes transformadas em defeitos\". A nossa criatividade que caracteriza esse excesso de imaginação dos portugueses \"só em Portugal podia haver um Fernando Pessoa\". Mas é pena que a criatividade, hoje, só nos serve para o nosso defeito de trafulhice. Um povo que o podia ser de criadores acaba por ser uma matilha de aldrabões. Não deixa de ser soberba a questão que se coloca: \"Já imaginaram o que seria o nosso Portugal se a energia que se aplica na vigarice se orientasse para actividades dignas?\" Para de imediato concordar com o distinto professor e (re) sublinhar o quanto este pormenor mostra como \"a nossa criatividade, que podia servir para tanta coisa boa, se está a reduzir a uma mera trafulhice do mero oportunismo.\" Em tempos não muito recuados, quando uma figura pública veio a terreiro lançar a confusão sobre a alegada orientação sexual de José Sócrates, atribuindo-lhe o gosto por outros colos, fiquei bastante indignado com essa atitude e o resultado da opinião pública eleitoral, não o foi menor. Nos alvores do Verão passado uma \"alegada caravana\" da revista Visão, e a pretexto de uma questão pessoal, se veio desse modo ofender a dignidade de Carlos Pinto, recorrendo ao nome de seu pai, de forma vil e despeitada. Manifestei-lhe de imediato a minha solidariedade e indignação pelo ato. Não gostei como é óbvio. Os ataques recentes a Carlos Casteleiro não passam de mais um desses procedimentos atávicos, onde a sua grandeza e heroicidade, é transformada em farsa e Carnaval de \"pretensos políticos a fazerem de conta que são de vistas cultas, requisitados intelectuais, e não passam de espertalhões com uma ou duas ideias eleitorais\". Termino segundo Gabriel Magalhães, \"Os verdadeiros heróis são pessoas humildes. Lúcidos. Que fazem aquilo que têm a fazer, sem dar nas vistas. A heroicidade a sério não se vê: não tem palco incluído\". \"A discrição é o terreno próprio da verdadeira valentia. Quem precisa de palmas é porque é covarde. Ou de como ser português, também tem sido isto: aprender a viver com a doença da portugalidade.\" Mas não devia ser isto, não devia…e fico triste, por isso\"."
title_plus_text_7 = title_7 + ". " + text_7

# BAD
title_8 =  "Aumentos na água criticados"
text_8 = "Comunistas consideram acréscimos \"brutais\" O PCP condena \"de forma inequívoca\" os novos aumentos na factura da água, que dizem acentuar o empobrecimento da população e são, \"uma vez mais, o resultado da negociata da privatização\". Os comunistas realçam que tanto a factura de cinco metros cúbicos como a de dez metros cúbicos, \"onde se situam a esmagadora maioria dos consumidores, registam aumentos acima de cinco por cento, bem acima da inflação prevista\". A comissão política concelhia classifica ainda de \"brutal\" o aumento da tarifa fixa dos resíduos, na ordem dos 22,5 por cento. Os novos valores das tarifas cobradas a quem tem captação própria, que sofreram um aumento de 44 por cento, são também censuradas pelo PCP, que considera as actuais taxas uma \"perseguição a todas as formas de auto-abastecimento, visando forçar a sua inclusão no monopólio da empresa e do negócio\". \"Estes aumentos são especialmente injustos num quadro em que a generalidade da população está a ser violentamente expropriada dos seus rendimentos\", lamentam os comunistas, críticos sobre a actuação da Águas da Covilhã. Já na reunião pública camarária de 20 de Janeiro Vítor Pereira, vereador socialista, tinha questionado a maioria sobre os aumentos na factura da água e pediu justificações sobre a discrepância das taxas cobradas a quem só utiliza a rede pública, que viu a factura aumentar 11 cêntimos o metro cúbico, a quem tem furos, e que foi confrontado com um aumento de 40 cêntimos. Presente na reunião José Calmeiro, administrador da Águas da Covilhã, disse que as pessoas com captação própria representam um universo de cerca de 500 consumidores e disse tratar-se de \"um problema de solidariedade\". Para o PCP \"depois dos brutais aumentos verificados em 2010 e 2011, as taxas fixadas para 2012 são o reflexo do \"insustentável preço da privatização\", referindo-se à alienação de 49 por cento do capital dos antigos Serviços Municipais de Água e Saneamento."
title_plus_text_8 = title_8 + ". " + text_8

# BAD
title_9 = "Cavaco reconduzido"
text_9 = "Na direcção da Banda da Covilhã José Eduardo Cavaco continua, nos próximos dois anos, à frente da Banda da Covilhã. A filarmónica foi a votos no sábado, 4, e os elementos da única lista a sufrágio tomam posse esta sexta-feira, 10, às 19h, na sede. Com muitas iniciativas a decorrer e outras tantas projectadas, ter um novo fardamento é um dos principais objectivos da Banda da Covilhã, que já dispõe do tecido. Em comunicado, a associação destaca a eleição de dois jovens para a direcção: Rui Jesus, com 18 anos, e Diogo Fernandes, de 21. A nota destaca ainda o regresso aos órgãos sociais de António Moreira, para presidir à Assembleia Geral, onde é acompanhado por Joaquim Garra e Rui Patrício. Luís Proença preside ao Conselho Fiscal, de que também fazem parte José Fernandes e José Pereira. Na direcção da Banda da Covilhã José Eduardo Cavaco tem o apoio das vice-presidentes Margarida Robbins e Alzira Lucas, dos secretários Teresa Carlos e Rui Jesus, dos tesoureiros Irene Ribeiro e Diogo Fernandes e dos vogais José Santarém e António Monteiro."
title_plus_text_9 = title_9 + ". " + text_9

# BAD
title_10 = "Emigrantes não sabem como se consegue viver cá"
text_10 = "Emigrantes criticam o custo de vida em Portugal Andam aí, um pouco por todo lado. Facilmente reconhecidos, com as t'shirts Nike ou Adidas, a camisola do Cristiano Ronaldo ou chapéu na cabeça, ostentando carros topo de gama, com música em altos sons, e com a bandeira nacional estampada nos vidros. Falamos dos emigrantes, que neste mês de Agosto, que está a chegar ao fim, deram vida a muitas vilas e aldeias da Beira Interior, algumas delas desertificadas É o chamado \"Querido mês de Agosto\", já imortalizado em filme, que faz com que, nesta época do ano, em algumas terras duplique a população. Mas só mesmo nesta altura, porque de futuro, muitos dizem não querer voltar. É o caso de Maria José. Aos 58 anos, e à beira de se reformar, já não pensa num regresso a casa, no concelho da Covilhã. Casada, com um filho, já tem dois netos e, afirma \"a minha casa é lá, não é aqui. Aqui não tenho nada\". Já chegou a ter. Construiu uma moradia que, passados alguns anos, acabou por vender, já que, para passar uns dias de férias, no Verão, \" a casa da minha mãe basta\". A opção foi realizar dinheiro para, sim, fazer uma casa no sul de França. \"É por lá que acabarei os últimos dias da minha vida. Tenho lá o filho, os netos, e eles nunca de lá virão, apesar de também virem cá passar uns dias de férias\". Até porque não vê vantagens algumas num regresso. \"Então, cá é tudo tão caro…. Impostos, luz, água, as mercearias, os carros, fogo, sei lá. Pelo que vejo, lá vivemos melhor. Ganhamos mais e o custo de vida não é tão grande\". O filho ainda fala português, embora esteja casado com uma cidadã francesa. Já os netos, não falam, mas percebem tudo. \"É sempre bom que pelo menos percebam a nossa língua. Em casa vamos falando para eles também aprenderem\" frisa. Já Vítor adora vir a Portugal. Mas também não pensa voltar para cá em definitivo. \"Não. É lá que trabalho, ganho bem, tenho uma vida boa e cá, da maneira que isto está…. De certeza que não volto. Venho cá em Agosto ver a malta\". Francisco está radicado na Suíça. Também já se reformou, tem dois filhos lá, que já estão \"bem empregados\" e por isso, vai também manter-se por lá, apesar de ter algum património na sua aldeia, no concelho da Covilhã. \"Tenho uma casa e um apartamento. A casa é para mim, quando cá venho no Verão. E o apartamento foi uma maneira de empregar algum dinheiro que lá ganhei. Está alugada\" afirma. Aos 67 anos, ainda equaciona a hipótese de um dia \"vir de todo\" mas \"só quando já for mesmo velhinho. Antes não\" assegura. \"A vida cá é muito cara\" Já Mário Batista, 63 anos, natural da Erada, concelho da Covilhã, ainda tem ideia de regressar, um dia, à sua terra natal. \"Penso em voltar, um dia a Portugal. Mas só quando já for muito cansativo andar a fazer viagens de França para cá \" assegura. Muito comunicativo, Mário explica-nos como começou a sua aventura por terras gaulesas. \"Fui de assalto, em 1967. Andei nove horas para lá chegar. Era muito difícil, passei vários obstáculos. Tinha apenas 18 anos, nunca tinha saído de casa sozinho, fui para junto de gente que não conhecia, uma língua estrangeira, mas só lá estive dois meses sem trabalhar. A 1 de Abril desse ano comecei a trabalhar numa empresa à qual estive sempre ligado e posso dizer que nunca conheci o desemprego\" assegura. Mário foi funcionário de uma empresa de construção civil, que se dedicava a obras públicas, na qual esteve até Abril deste ano. Agora está já reformado. \"Cheguei a ser o encarregado geral\" afirma, orgulhoso. Todos os anos regressa à Erada, no Verão. \"Agora tenho mais tempo, é possível que venha mais vezes\" afirma. A sua estada em França, na zona de Paris, apenas foi interrompida em 1970, quando teve que regressar para efectuar o serviço militar. \"Fui para o Ultramar. Andei 24 meses na Guiné. Foi nessa altura que conheci a minha esposa\" afirma. Do casamento, com uma jovem de Cortes do Meio, nasceram dois filhos, um rapaz e uma rapariga, que apesar de terem nascido em França, também eles vêm todos os anos à Erada. \"Sim, costumam vir. Mas a vida deles é lá\" afirma Mário. Sobre o País que cá encontrou, Mário diz que vê muita gente, em centros comerciais, \"mas só a ver. Comprar, nem por isso. Não se pode. A vida cá é muito cara. Não sei como é que as pessoas conseguem aqui viver. É preciso mesmo muita ginástica\""
title_plus_text_10 = title_10 + ". " + text_10

titles = [title_1, title_2, title_3, title_4, title_5, title_6, title_7, title_8, title_9, title_10]
texts = [text_1, text_2, text_3, text_4, text_5, text_6, text_7, text_8, text_9, text_10]
titles_plus_texts = [title_plus_text_1, title_plus_text_2, title_plus_text_3, title_plus_text_4, title_plus_text_5, title_plus_text_6, title_plus_text_7, title_plus_text_8, title_plus_text_9, title_plus_text_10]

getThreeModelsSimilarities(title_ref=title_ref, text_ref=text_ref, title_plus_text_ref=title_plus_text_ref, titles=titles, texts=texts, titles_plus_texts=titles_plus_texts)
